<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recibos</title>
  <link href="/out/css/output.css" rel="stylesheet"/>
  <script src="/out/js/index.js" defer></script>
</head>
<body>

<div class="bg-base-100 flex flex-col gap-1 p-1 fade-me-in fade-me-out" id="header-container" hx-swap-oob="true">
  <div id="progress-receipts" class="text-center">
  </div>
  <div class="header">

    <div id="receipts-updater"
         hidden="hidden"
         hx-get="/api/receipts"
         hx-include="[name='building_input'],[name='month_input'],[name='date_input']"
         hx-trigger="update_receipts delay:300ms"
         hx-target="#receipt-grid"
         hx-swap="innerHTML"
         hx-indicator=".htmx-indicator"
    >

    </div>

    <div id="receipts-counters"></div>

    <div x-data="{
    buildings: [],
    buildings_selected: []
    }"
         x-init="$watch('buildings_selected', value => document.getElementById('receipts-updater').dispatchEvent(new CustomEvent('update_receipts')))"
    >
      <div hx-get="/api/buildings/ids"
           hx-trigger="load"
           hx-swap="outerHTML"
      >

      </div>
      <button class="btn btn-outline" @click.prevent="$el.nextElementSibling.showModal()">
        <h2 class="text-center">EDIFICIOS: <span x-text="buildings_selected.length"></span></h2>
      </button>
      <dialog class="modal modal-bottom sm:modal-middle">
        <div class="modal-box">
          <div class="flex flex-row gap-2 justify-around">
            <div class="w-fit">
              <template x-for="building in buildings">
                <label class="label justify-start gap-4 cursor-pointer">
                  <input type="checkbox" class="checkbox" name="building_input"
                         @click="buildings_selected.includes(building) ? buildings_selected = buildings_selected.filter(a => a !== building) : buildings_selected.push(building);"
                         x-bind:checked="buildings_selected.includes(building)"
                         x-bind:value="building"/>
                  <span class="label-text" x-text="building"></span>
                </label>
              </template>
            </div>

            <div class="flex flex-col justify-between">
              <div class="modal-action mt-0">
                <form method="dialog">
                  <button class="btn btn-circle btn-outline">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </form>
              </div>

              <button class="btn btn-outline"
                      @click.prevent="if (buildings_selected.length > 0) buildings_selected = []">
                Limpiar
              </button>
            </div>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop">
          <button>close</button>
        </form>
      </dialog>
    </div>

    <div x-data="{
      months: [
    {name: 'ENERO', month: 1},
    {name: 'FEBRERO', month: 2},
    {name: 'MARZO', month: 3},
    {name: 'ABRIL', month: 4},
    {name: 'MAYO', month: 5},
    {name: 'JUNIO', month: 6},
    {name: 'JULIO', month: 7},
    {name: 'AGOSTO', month: 8},
    {name: 'SEPTIEMBRE', month: 9},
    {name: 'OCTUBRE', month: 10},
    {name: 'NOVIEMBRE', month: 11},
    {name: 'DICIEMBRE', month: 12}
    ],
    months_selected: []
    }"
         x-init="$watch('months_selected', value => document.getElementById('receipts-updater').dispatchEvent(new CustomEvent('update_receipts')))"
    >

      <button class="btn btn-outline" @click.prevent="$el.nextElementSibling.showModal()">
        <h2 class="text-center">MESES: <span x-text="months_selected.length"></span></h2>
      </button>
      <dialog class="modal modal-bottom sm:modal-middle">
        <div class="modal-box">
          <div class="flex flex-row gap-2 justify-around">
            <div class="w-fit">
              <template x-for="value in months">
                <label class="label justify-start gap-4 cursor-pointer">
                  <input type="checkbox" class="checkbox" name="month_input"
                         @click="months_selected.includes(value.month) ? months_selected = months_selected.filter(a => a !== value.month) : months_selected.push(value.month);"
                         x-bind:checked="months_selected.includes(value.month)"
                         x-bind:value="value.month"/>
                  <span class="label-text" x-text="value.name"></span>
                </label>
              </template>
            </div>

            <div class="flex flex-col justify-between">
              <div class="modal-action mt-0">
                <form method="dialog">
                  <button class="btn btn-circle btn-outline">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </form>
              </div>

              <button class="btn btn-outline" @click.prevent="if (months_selected.length > 0) months_selected = []">
                Limpiar
              </button>
            </div>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop">
          <button>close</button>
        </form>
      </dialog>
    </div>

    <input class="datepicker"
           type="date"
           name="date_input"
           placeholder="YYYY-MM-DD"
           script="on change send 'update_receipts' to #receipts-updater">

    <form hx-post="/api/receipts/file"
          hx-encoding='multipart/form-data'
          hx-disabled-elt="this, input:not([disabled])"
          hx-swap="none"
          hx-trigger="send-file"
          hx-indicator=".htmx-indicator">

      <input class="file-input file-input-bordered w-full max-w-xs"
             type="file"
             accept=".xlsx,.xls"
             name="file"
             onchange="this.parentElement.dispatchEvent(new CustomEvent('send-file'))"
      />

      <div hidden="hidden" id="csrf-input-file-input"></div>


    </form>

    <img class="htmx-indicator white-filter" src="/assets/bars.svg" alt="spinner">
  </div>
</div>

<div id="container" hx-swap-oob="true" class="p-2 gap-1 flex flex-col"
     x-data="{
     zip_dialog_receipt_key: '', zip_dialog_building: '', zip_dialog_date: '', zip_dialog_year: 0, zip_dialog_month: '',
     send_dialog_receipt_key: '', send_dialog_building: '', send_dialog_date: '', send_dialog_year: 0, send_dialog_month: '',
     send_dialog_receipt_select_all : true, send_dialog_apts: []}">

  <div id="dialog-helper" hidden="hidden"></div>

  <div id="receipt-grid">
    <div hx-get="/api/receipts/init" hx-indicator=".htmx-indicator" hx-trigger="load" hx-swap="outerHTML"></div>
  </div>

  <div>
    <img class="htmx-indicator center img-medium-size white-filter" src="/assets/bars.svg" alt="spinner">
  </div>

  <dialog id="dialog-cm" hidden="hidden">

  </dialog>

  <div hx-get="/receipts/zipDialog.html"
       hx-trigger="load"
       hx-swap="outerHTML"
  >

  </div>

  <div hx-get="/receipts/sendDialog.html"
       hx-trigger="load"
       hx-swap="outerHTML"
  >

  </div>

</div>


</body>
</html>